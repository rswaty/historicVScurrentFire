---
title: "Historical Fire"
author: "TNC's LANDFIRE team"
date: "2022-03-09"
output: 
  workflowr::wflow_html:
    code_folding: hide
editor_options:
  chunk_output_type: console
---

```{r packages, message=FALSE, warning=FALSE, include=FALSE}
# install packages
library(DT)
library(scales)
library(stringr)
library(tidyverse)

# load raw data
lmrng_cmbn <- read_csv("data/lmrng_cmbn.csv")
```


## The inputs and GIS methods (briefly)
Vestibulum hendrerit ipsum eu diam sollicitudin, non tempus ipsum euismod. Phasellus eget elementum nibh. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Ut at bibendum neque. Vestibulum condimentum faucibus bibendum. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Cras pellentesque ultricies ante, at auctor erat.

## Historical Fire for the Little Missouri National Grasslands
As mentioned above we generated a big messy table for our exploration.  You can explore the raw table here. It's huge, even though the landscape is not that large. 
```{r lmr datatable, echo=FALSE, message=FALSE, warning=FALSE}
DT::datatable(head(lmrng_cmbn))
```

### Wrangle the data
The above data has too much information and is not formatted properly to explore historical fire regimes for our landscape.  We did some wranging.  Hit the "Code" button at the top-right of the page to see the code.

```{r bpsWrangle, echo=FALSE, message=FALSE, warning=FALSE}
lmrng_bps <- lmrng_cmbn %>%
  select(3, 10:15) %>%
  group_by(BPS_NAME,
           FRI_REPLAC,
           FRI_MIXED,
           FRI_SURFAC,
           FRI_ALLFIR) %>%
  summarise(groupedCount = sum(COUNT)) %>%
  arrange(desc(groupedCount)) %>%
  mutate(ACRES = (groupedCount*0.222)) %>%
  pivot_longer(cols = 2:5,
               names_to = "fireType",
               values_to = "returnInterval") %>%
  mutate(annualProb = (1/returnInterval),
         annualAcres = (annualProb*ACRES),
         percentAnnual = ((annualAcres/ACRES)*100)
         ) 

```


### Take look at historical ecosystems

LANDFIRE data is designed for use over large areas.  It's a good idea to review initial outputs before proceeding.  For example here we want to see which Biophysical Settings were most prevalent before we go to calculate historical fire regimes.

```{r bpsChart, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left', fig.width=12, fig.height=14}

lmrng_bps$shortName <- str_wrap(lmrng_bps$BPS_NAME, width = 30)

lmrngBpsChart <-
  ggplot(lmrng_bps, aes(y = ACRES, x = reorder(shortName, -ACRES))) +
  geom_bar(stat = "identity", fill = "#268754") +
  coord_flip() +
  labs(
    title = "Acreage of each Biophysical Setting mapped on the Landscape",
    subtitle = "Represents dominant vegetation systems prior to European colonization",
    caption = "Data from landfire.gov.",
    x = "",
    y = "Acres",
    fill = "Status") +
  scale_x_discrete(limits=rev)  +
	scale_y_continuous(labels = comma) + 
  theme_bw(base_size = 18) + 
  theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot")


lmrngBpsChart
```

From this we see:

1. The Northwestern Great Plains Mixedgrass Prairie was by far the most dominant BpS.
2. Reviewing this chart and LANDFIRE model descriptions and metadata we decide to remove all BpSs except the top three for this initial assessment.  Here's why:
    * Barren-Rock/Sand/Clay, Open Water and sparsely vegetated systems (such as the Western Great Plains Sparsely Vegetated Systems) do not have modeled historical fire regimes
    * The rest of the BpSs had relatively small acreages (< 1,000 acres)

The historical annual acres burned chart will only represent the top three BpSs by acreage. 




```{r fireChart, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left', fig.width=12, fig.height=10}

lmrng_bps3 <- lmrng_bps %>%
  filter(BPS_NAME %in% c("Northwestern Great Plains Mixedgrass Prairie",
                         "Western Great Plains Wooded Draw and Ravine",
                         "Western Great Plains Floodplain Systems"))


annualFireChart_lmrng <- lmrng_bps3 %>%
  ggplot(aes(fill=(fireType), y=annualAcres, x=reorder(BPS_NAME, ACRES))) + 
  geom_col(width = 0.8, position = position_dodge()) +
  coord_flip() +
	scale_y_continuous(labels = comma) + 
  labs(
    title = "Historical annual acres burned per BpS",
    subtitle = "Split out by fire type",
    caption = "Data from landfire.gov.",
    x = "",
    y = "Acres")+
  theme_bw(base_size = 18)+ 
  theme(legend.position = c(0.8, 0.2)) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot") +
  scale_fill_manual(values = c("#AA3377" , #ALL
                               "#b57805", #MIXED
                               "#8a8978", #REPLACEMENT
                               "#d6d25c"), # SURFACE
                    name = "Fire Type", 
                    labels = c("All",
                               "Mixed",
                               "Replacement",
                              "Surface"))

annualFireChart_lmrng
```

The Northwestern Great Plains Mixedgrass Prairie had a historical Mean Fire Return Interval of ~13 years, which in turn meant that ~8% of that ecosystem burned every year, or almost 6k acres for this landscape. 



