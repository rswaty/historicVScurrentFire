---
title: "Historical Fire"
author: "TNC's LANDFIRE team"
date: "2022-03-09"
output: 
  workflowr::wflow_html:
    code_folding: hide
editor_options:
  chunk_output_type: console
---

```{r packages, message=FALSE, warning=FALSE, include=FALSE}
# install packages
library(DT)
library(scales)
library(stringr)
library(tidyverse)

# load raw data
hmnf <- read_csv("data/hmnf2_cmbn.csv")
okswmp <- read.csv("data/ok_cmbn.csv")
```


## The inputs and GIS methods (briefly)
Vestibulum hendrerit ipsum eu diam sollicitudin, non tempus ipsum euismod. Phasellus eget elementum nibh. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Ut at bibendum neque. Vestibulum condimentum faucibus bibendum. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Cras pellentesque ultricies ante, at auctor erat.

## Historical Fire for the Huron-Manistee National Forest
As mentioned above we generated a big messy table for our exploration.  You can explore the raw table minus VALUE fields here. It's huge, even though the landscape is not that large. 
```{r lmr datatable, echo=FALSE, message=FALSE, warning=FALSE}
DT::datatable((hmnf[13:22]))
```

### Wrangle the data
The above data has too much information and is not formatted properly to explore historical fire regimes for our landscape.  We did some wranging.  Hit the "Code" button at the top-right of the page to see the code.

```{r bpsWrangle, echo=FALSE, message=FALSE, warning=FALSE}
hmnf_bps <- hmnf %>%
  select(3, 12:17) %>%
  group_by(BPS_NAME,
           FRI_REPLAC,
           FRI_MIXED,
           FRI_SURFAC,
           FRI_ALLFIR,
           BPS_MODEL) %>%
  summarise(groupedCount = sum(COUNT)) %>%
  arrange(desc(groupedCount)) %>%
  mutate(ACRES = (groupedCount*0.222)) %>%
  pivot_longer(cols = 2:5,
               names_to = "fireType",
               values_to = "returnInterval") %>%
  mutate(annualProb = (1/returnInterval),
         annualAcres = (annualProb*ACRES),
         percentAnnual = ((annualAcres/ACRES)*100)
         ) 



write.csv(hmnf_bps, file = "hmnf_fire.csv")

```


### Take look at historical ecosystems

LANDFIRE data is designed for use over large areas.  It's a good idea to review initial outputs before proceeding.  For example here we want to see which Biophysical Settings were most prevalent before we go to calculate historical fire regimes.

```{r bpsChart, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left', fig.width=12, fig.height=14}

hmnf_bps$shortName <- str_wrap(hmnf_bps$BPS_NAME, width = 30)

hmnfBpsChart <-
  ggplot(hmnf_bps, aes(y = ACRES, x = reorder(shortName, -ACRES))) +
  geom_bar(stat = "identity", fill = "#268754") +
  coord_flip() +
  labs(
    title = "Acreage of each Biophysical Setting mapped on the Landscape",
    subtitle = "Represents dominant vegetation systems prior to European colonization",
    caption = "Data from landfire.gov.",
    x = "",
    y = "Acres",
    fill = "Status") +
  scale_x_discrete(limits=rev)  +
	scale_y_continuous(labels = comma) + 
  theme_bw(base_size = 18) + 
  theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot")


hmnfBpsChart
```

From this we see:

1. There were a mix of highly fire-dependent (e.g., Laurentian-Acadian Northern Pine(-Oak) Forest) and much less fire-adapted ecosystems (Laurentian-Acadian Northern Hardwoods Forest-Hemlock) on the landscape historically.
2. Reviewing this chart and LANDFIRE model descriptions and metadata we decide to remove all BpSs except the top five for this initial assessment.  Here's why:
    * Barren-Rock/Sand/Clay, Open Water and sparsely vegetated systems (such as the Western Great Plains Sparsely Vegetated Systems) do not have modeled historical fire regimes
    * These five represented over 90% of the landscape and represent a wide variety of edaphic and fire conditions.

The historical annual acres burned chart will only represent the top five BpSs by acreage. 




```{r fireChart, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left', fig.width=12, fig.height=10}

hmnf_bpsNoALL <- hmnf_bps %>%
  filter(fireType %in% c("FRI_REPLAC",
                         "FRI_MIXED",
                         "FRI_SURFAC"))


annualFireChart_hmnf <- hmnf_bpsNoALL %>%
  ggplot(aes(fill=(fireType), y=annualAcres, x=reorder(BPS_NAME, ACRES))) + 
  geom_bar(position="stack", stat="identity") +
  coord_flip() +
	scale_y_continuous(labels = comma) + 
  labs(
    title = "Historical annual acres burned per BpS",
    subtitle = "Split out by fire type",
    caption = "Data from landfire.gov.",
    x = "",
    y = "Acres")+
  theme_bw(base_size = 18)+ 
  theme(legend.position = c(0.8, 0.2)) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot") +
  scale_fill_manual(values = c("#AA3377" , #ALL
                               "#b57805", #MIXED
                               "#8a8978", #REPLACEMENT
                               "#d6d25c"), # SURFACE
                    name = "Fire Type", 
                    labels = c("Mixed",
                               "Replacement",
                              "Surface"))

annualFireChart_hmnf

```

The Northwestern Great Plains Mixedgrass Prairie had a historical Mean Fire Return Interval of ~13 years, which in turn meant that ~8% of that ecosystem burned every year, or almost 6k acres for this landscape. 


## Historical Fire for the Okefeenokee Swamp
As mentioned above we generated a big messy table for our exploration.  You can explore the raw table minus VALUE fields here. It's huge, even though the landscape is not that large. 
```{r ok datatable, echo=FALSE, message=FALSE, warning=FALSE}
DT::datatable((okswmp[13:22]))
```

### Wrangle the data
The above data has too much information and is not formatted properly to explore historical fire regimes for our landscape.  We did some wranging.  Hit the "Code" button at the top-right of the page to see the code.

```{r okBpsWrangle, echo=FALSE, message=FALSE, warning=FALSE}
okswmp_bps <- okswmp %>%
  select(3, 12:17) %>%
  group_by(BPS_NAME,
           FRI_REPLAC,
           FRI_MIXED,
           FRI_SURFAC,
           FRI_ALLFIR,
           BPS_MODEL) %>%
  summarise(groupedCount = sum(Count)) %>%
  arrange(desc(groupedCount)) %>%
  mutate(ACRES = (groupedCount*0.222)) %>%
  pivot_longer(cols = 2:5,
               names_to = "fireType",
               values_to = "returnInterval") %>%
  mutate(annualProb = (1/returnInterval),
         annualAcres = (annualProb*ACRES),
         percentAnnual = ((annualAcres/ACRES)*100)
         ) 

write.csv(okswmp_bps, file = "okswamp_fire.csv")

```


### Take look at historical ecosystems

LANDFIRE data is designed for use over large areas.  It's a good idea to review initial outputs before proceeding.  For example here we want to see which Biophysical Settings were most prevalent before we go to calculate historical fire regimes.

```{r OKbpsChart, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left', fig.width=12, fig.height=14}

okswmp_bps$shortName <- str_wrap(okswmp_bps$BPS_NAME, width = 30)

okswmpBpsChart <-
  ggplot(okswmp_bps, aes(y = ACRES, x = reorder(shortName, -ACRES))) +
  geom_bar(stat = "identity", fill = "#268754") +
  coord_flip() +
  labs(
    title = "Acreage of each Biophysical Setting mapped on the Landscape",
    subtitle = "Represents dominant vegetation systems prior to European colonization",
    caption = "Data from landfire.gov.",
    x = "",
    y = "Acres",
    fill = "Status") +
  scale_x_discrete(limits=rev)  +
	scale_y_continuous(labels = comma) + 
  theme_bw(base_size = 18) + 
  theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot")


okswmpBpsChart
```

From this we see:



The historical annual acres burned chart will only represent the top five BpSs by acreage. 




```{r OKfireChart, echo=FALSE, message=FALSE, warning=FALSE, fig.align='left', fig.width=12, fig.height=10}

okswmp_bpsNoALL <- okswmp_bps %>%
  filter(fireType %in% c("FRI_REPLAC",
                         "FRI_MIXED",
                         "FRI_SURFAC"))


annualFireChart_okswmp <- okswmp_bpsNoALL %>%
  ggplot(aes(fill=(fireType), y=annualAcres, x=reorder(BPS_NAME, ACRES))) + 
  geom_bar(position="stack", stat="identity") +
  coord_flip() +
	scale_y_continuous(labels = comma) + 
  labs(
    title = "Historical annual acres burned per BpS",
    subtitle = "Split out by fire type",
    caption = "Data from landfire.gov.",
    x = "",
    y = "Acres")+
  theme_bw(base_size = 18)+ 
  theme(legend.position = c(0.8, 0.2)) +
  theme(plot.caption = element_text(hjust = 0, face= "italic"), #Default is hjust=1
        plot.title.position = "plot", #NEW parameter. Apply for subtitle too.
        plot.caption.position =  "plot") +
  scale_fill_manual(values = c("#AA3377" , #ALL
                               "#b57805", #MIXED
                               "#8a8978", #REPLACEMENT
                               "#d6d25c"), # SURFACE
                    name = "Fire Type", 
                    labels = c("Mixed",
                               "Replacement",
                              "Surface"))

annualFireChart_okswmp

```




